# BPMN Сценарий 1: Регистрация пациента

## Участники (Pools)
- **Пациент**
- **Система диагностики**
- **Email-сервис**

## BPMN Диаграмма

```mermaid
graph TB
    Start([Начало])
    
    subgraph "Пул: Пациент"
        P1[Открывает форму<br/>регистрации]
        P2[Заполняет поля<br/>Email, Пароль, ФИО]
        P3[Кликает по ссылке<br/>в письме]
    end
    
    subgraph "Пул: Система диагностики"
        S1{Email<br/>валиден?}
        S2[Проверка<br/>уникальности email]
        S3{Email уже<br/>существует?}
        S4[Хеширование<br/>пароля BCrypt]
        S5[Сохранение в<br/>PostgreSQL]
        S6[Генерация токена<br/>активации]
        S7[Активация<br/>аккаунта]
    end
    
    subgraph "Пул: Email-сервис"
        E1[Отправка письма<br/>с токеном]
    end
    
    Start --> P1
    P1 --> P2
    P2 --> S1
    S1 -->|Нет| P2
    S1 -->|Да| S2
    S2 --> S3
    S3 -->|Да| P2
    S3 -->|Нет| S4
    S4 --> S5
    S5 --> S6
    S6 --> E1
    E1 --> P3
    P3 --> S7
    S7 --> End([Конец])
    
    style Start fill:#67c23a,stroke:#4a9428,stroke-width:2px
    style End fill:#f56c6c,stroke:#c94545,stroke-width:2px
    style S1 fill:#e6a23c,stroke:#b8821e,stroke-width:2px
    style S3 fill:#e6a23c,stroke:#b8821e,stroke-width:2px
    style E1 fill:#9966ff,stroke:#7744cc,stroke-width:2px,color:#fff
```

## Процесс

1. **Старт:** Пациент открывает форму регистрации
2. **Задача:** Заполнение формы (email, пароль, ФИО)
3. **Шлюз (XOR):** Проверка email
   - **Валидный:** Продолжить регистрацию
   - **Невалидный:** Показать ошибку → возврат к заполнению
4. **Задача:** Проверка уникальности email
5. **Шлюз (XOR):** Email уже существует?
   - **Да:** Показать ошибку → возврат к заполнению
   - **Нет:** Продолжить
6. **Задача:** Хеширование пароля BCrypt
7. **Задача:** Создание записи в PostgreSQL
8. **Задача:** Генерация токена активации
9. **Задача:** Отправка письма подтверждения (Email-сервис)
10. **Событие:** Ожидание клика по ссылке
11. **Задача:** Активация аккаунта
12. **Конец:** Успешная регистрация

## Особенности
- **Шлюз исключающий (XOR):** Только один путь выполняется
- **Пулы:** Разделение ответственности между участниками
- **События:** Временное ожидание действия пользователя
