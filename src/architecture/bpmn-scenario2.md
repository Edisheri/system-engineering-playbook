# BPMN Сценарий 2: Загрузка данных

## Участники
- **Пациент**
- **API Gateway**
- **Storage Service (S3)**
- **Message Broker (RabbitMQ)**

## BPMN Диаграмма

```mermaid
graph TB
    Start([Начало])
    
    subgraph "Пул: Пациент"
        P1[Нажимает Загрузить]
        P2[Выбирает файлы]
        P3[Ожидает подтверждение]
    end
    
    subgraph "Пул: API Gateway"
        A1[Валидация формата]
        A2{Формат корректен?}
        A3[Проверка размера]
        A4{Размер ≤ 10 МБ?}
        A5[Генерация ID]
    end
    
    subgraph "Пул: S3"
        S1[Сохранение в S3]
        S2[Возврат URL]
    end
    
    subgraph "Пул: RabbitMQ"
        M1[Отправка в очередь]
        M2[Подтверждение]
    end
    
    Start --> P1
    P1 --> P2
    P2 --> A1
    A1 --> A2
    A2 -->|Нет| P2
    A2 -->|Да| A3
    A3 --> A4
    A4 -->|Нет| P2
    A4 -->|Да| A5
    A5 --> S1
    S1 --> S2
    S2 --> M1
    M1 --> M2
    M2 --> P3
    P3 --> End([Конец])
    
    style Start fill:#67c23a,stroke:#4a9428,stroke-width:2px
    style End fill:#f56c6c,stroke:#c94545,stroke-width:2px
    style A2 fill:#e6a23c,stroke:#b8821e,stroke-width:2px
    style A4 fill:#e6a23c,stroke:#b8821e,stroke-width:2px
    style S1 fill:#ff9900,stroke:#cc7700,stroke-width:2px
    style M1 fill:#ff6600,stroke:#cc5200,stroke-width:2px,color:#fff
```

## Процесс

1. **Старт:** Пациент нажимает "Загрузить данные"
2. **Задача:** Выбор файлов (изображения/текст)
3. **Шлюз (XOR):** Проверка формата файла
   - **JPEG/PNG/TXT:** Продолжить
   - **Другой формат:** Показать ошибку
4. **Шлюз (XOR):** Проверка размера
   - **≤ 10 МБ:** Продолжить
   - **> 10 МБ:** Показать ошибку
5. **Задача:** Генерация уникального ID
6. **Задача:** Сохранение в S3
7. **Задача:** Отправка сообщения в RabbitMQ
8. **Событие:** Подтверждение получения
9. **Конец:** Данные загружены

## Особенности
- **Последовательные шлюзы:** Многоуровневая валидация
- **Асинхронность:** RabbitMQ обрабатывает данные независимо
